<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <title>ZXing QR 리더기 (모듈 + 리사이즈)</title>
  <script type="module" src="zxing-drop-reader.js"></script>
</head>

<body>
  <h2>QR 이미지를 드래그해서 올려보세요</h2>
  <div id="drop-zone"></div>
  <div id="qr-output" style="margin-top: 10px; font-weight: bold;"></div>

  <script type="module">
    import { initZxingQrDropReader } from './zxing-drop-reader.js';

    initZxingQrDropReader({
      dropTargetSelector: '#drop-zone',
      outputSelector: '#qr-output'
    });

    window.onQrCodeDecoded = (text) => {

      text = text + 'q' + lotto;

      // 방법 1 - replace로 해결
      // text = text.replace('1183', '1184');
      // console.log(text);

      //방법 2 - substring, indexof 로 해보기
      console.log(text);
      const s = text.split("&v=");
      console.log(s);
      s[1] = s[1].substring(4);
      text = s[0] + '&v=1184' + s[1];
      console.log(text);



      location = text; //지정 url로 접속
      //팝업창 열기
      open(text, '', 'width=200px, height=300px');
    };

    const url = 'http://ggoreb.com/api/lotto.jsp';

    let lotto = '';
    //fetch가 비동기
    fetch(url)
      .then(function a(msg) {
        console.log(msg);
        return msg.json();
      })
      .then(function b(msg) {
        console.log(msg);
        lotto = msg.num1 + msg.num2 + msg.num3 + msg.num4 + msg.num5 + msg.num6;
        console.log(lotto);
      });
  </script>
</body>

</html>