<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css
/bootstrap.min.css" rel="stylesheet">
</head>

<body>
    <div class="container mt-4">
        <input type="text">
        <button>검색</button>
        <h2>세종시 야간 약국 정보</h2>
        <div id="content"></div>
        <div id="weather"></div>
    </div>

    <script>
        const input = document.querySelector('input');
        const button = document.querySelector('button');
        button.addEventListener('click', async () => {
            const search = input.value;
            console.log(search);
            if (!search == '') {
                await getData(search);
                await f(url);
            }

        })

        async function getData(search) {
            const url =
                `https://ggoreb.pythonanywhere.com/night_pharmacy/data/?search=${search}`;
            const res = await fetch(url);
            const json = await res.json();
            const data = json.data;

            let html = `<table class="table table-bordered table-striped" >
                          <thead class="table-dark">
            <tr>
                <th>약국명</th>
                <th>전화번호</th>
                <th>주소</th>
            </tr>
        </thead>
        <tbody>`;
            data.forEach((v, i) => {
                const name = v.name;
                const tel = v.tel;
                const road = v.road_address;

                html += `
                        <tr>
                        <td>${name}</td>
                        <td>${tel}</td>
                        <td> ${road}</td>
                        </tr>`;
            });
            html += `</tbody>
                    </table>`;
            const content = document.querySelector('#content');
            content.innerHTML = html;

            const trs = document.querySelectorAll('tr');
            for (const tr of trs) {
                tr.addEventListener('click', (e) => {
                    alert(e.target.innerText);
                });
            }
        };

        const url = 'https://api.openweathermap.org/data/2.5/weather?lat=35.1728639953646&lon=129.130680529903&units=metric&appid=6edee3c2aa182bc44d18ccb204c98a31';
        async function f(url) {
            const res = await fetch(url);
            const json = await res.json();
            const data = json.weather[0];
            console.log(data);
            const description = data.description;
            const icon = data.icon;
            const temp = json.main.temp;
            document.querySelector('#weather').innerHTML = `${description} / ${temp} / <img src='http://openweathermap.org/img/wn/${icon}@2x.png'>`;
        }



    </script>


</body>